
from os import path

from pdfquery import PDFQuery

from parser import parse


def q(coord):
    return 'LTTextLineHorizontal:in_bbox("{}")'.format(coord)


def scrape(pdf_file):
    pdf = PDFQuery(path.join('pdfs/', pdf_file))
    pdf.load()

    return parse([
        pdf.extract([
            ('with_parent', 'LTPage[pageid="1"]'),
            ('with_formatter', 'text'),
            ('produto1', q('22.68,625.741,112.14,633.833')),
            ('unidade', q('206.93,625.741,220.93,633.833')),
            ('grandezas_faturadas', q('268.45,625.741,297.64,633.833')),
            ('valor_unitario', q('353.49,625.741,382.68,633.833')),
            ('valor_total', q('426.3,625.741,453.544,633.833')),
            ('base_de_calculo', q('482.99,625.741,510.234,633.833')),
            ('aliquota_icms', q('549.42,625.741,566.934,633.833')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="1"]'),
            ('with_formatter', 'text'),
            ('produto1', q('22.68,617.241,123.431,625.333')),
            ('unidade', q('206.93,617.241,220.93,625.333')),
            ('grandezas_faturadas', q('268.45,617.241,297.64,625.333')),
            ('valor_unitario', q('353.49,617.241,382.68,625.333')),
            ('valor_total', q('432.14,617.241,453.546,625.333')),
            ('base_de_calculo', q('488.83,617.241,510.236,625.333')),
            ('aliquota_icms', q('549.42,617.241,566.934,625.333')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="1"]'),
            ('with_formatter', 'text'),
            ('produto1', q('22.68,608.731,111.755,616.823')),
            ('unidade', q('206.93,608.731,220.93,616.823')),
            ('grandezas_faturadas', q('276.23,608.731,297.636,616.823')),
            ('valor_unitario', q('353.49,608.731,382.68,616.823')),
            ('valor_total', q('432.14,608.731,453.546,616.823')),
            ('base_de_calculo', q('488.83,608.731,510.236,616.823')),
            ('aliquota_icms', q('549.42,608.731,566.934,616.823')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="1"]'),
            ('with_formatter', 'text'),
            ('produto1', q('22.68,600.231,74.403,608.323')),
            ('unidade', q('206.93,600.231,217.038,608.323')),
            ('grandezas_faturadas', q('280.12,600.231,297.634,608.323')),
            ('valor_unitario', q('349.6,600.231,382.682,608.323')),
            ('valor_total', q('426.3,600.231,453.544,608.323')),
            ('base_de_calculo', q('482.99,600.231,510.234,608.323')),
            ('aliquota_icms', q('549.42,600.231,566.934,608.323')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="1"]'),
            ('with_formatter', 'text'),
            ('produto1', q('22.68,591.731,125.37,599.823')),
            ('unidade', q('206.93,591.731,220.93,599.823')),
            ('grandezas_faturadas', ''),
            ('valor_unitario', ''),
            ('valor_total', q('432.14,591.731,453.546,599.823')),
            ('base_de_calculo', q('488.83,591.731,510.236,599.823')),
            ('aliquota_icms', q('549.42,591.731,566.934,599.823')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,573.301,117.81,581.393')),
            ('leitura_anterior', q('205.2,573.301,232.444,581.393')),
            ('leitura_anual', q('261.89,573.301,289.134,581.393')),
            ('medido', q('316.64,573.301,345.83,581.393')),
            ('contratado', ''),
            ('faturado', q('430.02,573.301,459.21,581.393')),
            ('tarifa', q('486.72,573.301,515.91,581.393')),
            ('total', q('545.35,573.301,572.594,581.393')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,564.801,129.101,572.893')),
            ('leitura_anterior', q('205.2,564.801,232.444,572.893')),
            ('leitura_anual', q('261.89,564.801,289.134,572.893')),
            ('medido', q('316.64,564.801,345.83,572.893')),
            ('contratado', ''),
            ('faturado', q('430.02,564.801,459.21,572.893')),
            ('tarifa', q('486.72,564.801,515.91,572.893')),
            ('total', q('551.19,564.801,572.596,572.893')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,556.291,117.425,564.383')),
            ('leitura_anterior', ''),
            ('leitura_anual', ''),
            ('medido', q('324.42,556.291,345.826,564.383')),
            ('contratado', ''),
            ('faturado', q('437.81,556.291,459.216,564.383')),
            ('tarifa', q('486.72,556.291,515.91,564.383')),
            ('total', q('551.19,556.291,572.596,564.383')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,547.791,80.073,555.883')),
            ('leitura_anterior', q('216.87,547.791,232.438,555.883')),
            ('leitura_anual', q('273.57,547.791,289.138,555.883')),
            ('medido', q('328.31,547.791,345.824,555.883')),
            ('contratado', q('385.01,547.791,402.524,555.883')),
            ('faturado', q('441.7,547.791,459.214,555.883')),
            ('tarifa', q('482.82,547.791,515.902,555.883')),
            ('total', q('545.35,547.791,572.594,555.883')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,539.281,131.04,547.373')),
            ('leitura_anterior', ''),
            ('leitura_anual', ''),
            ('medido', ''),
            ('contratado', ''),
            ('faturado', ''),
            ('tarifa', ''),
            ('total', q('551.19,539.281,572.596,547.373')),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,530.781,143.871,538.873')),
            ('leitura_anterior', q('205.2,530.781,232.444,538.873')),
            ('leitura_anual', q('261.89,530.781,289.134,538.873')),
            ('medido', q('320.53,530.781,345.828,538.873')),
            ('contratado', ''),
            ('faturado', ''),
            ('tarifa', ''),
            ('total', ''),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,522.281,150.094,530.373')),
            ('leitura_anterior', q('205.2,522.281,232.444,530.373')),
            ('leitura_anual', q('261.89,522.281,289.134,530.373')),
            ('medido', q('316.64,522.281,345.83,530.373')),
            ('contratado', ''),
            ('faturado', ''),
            ('tarifa', ''),
            ('total', ''),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,513.771,106.533,521.863')),
            ('leitura_anterior', q('212.98,513.771,232.44,521.863')),
            ('leitura_anual', q('269.67,513.771,289.13,521.863')),
            ('medido', q('328.31,513.771,345.824,521.863')),
            ('contratado', ''),
            ('faturado', ''),
            ('tarifa', ''),
            ('total', ''),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,505.271,106.533,513.363')),
            ('leitura_anterior', q('209.09,505.271,232.442,513.363')),
            ('leitura_anual', q('265.78,505.271,289.132,513.363')),
            ('medido', q('324.42,505.271,345.826,513.363')),
            ('contratado', ''),
            ('faturado', ''),
            ('tarifa', ''),
            ('total', ''),
        ]),
        pdf.extract([
            ('with_parent', 'LTPage[pageid="3"]'),
            ('with_formatter', 'text'),
            ('produto2', q('28.35,496.771,103.026,504.863')),
            ('leitura_anterior', q('205.2,496.771,232.444,504.863')),
            ('leitura_anual', q('261.89,496.771,289.134,504.863')),
            ('medido', q('320.53,496.771,345.828,504.863')),
            ('contratado', ''),
            ('faturado', ''),
            ('tarifa', ''),
            ('total', ''),
        ]),
    ])
